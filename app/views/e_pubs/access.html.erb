<% provide :page_title, @title || "Access Restricted to #{@monograph_presenter.title}" %>
<div class="alert alert-danger">
  <p class="text-center"><em><%= @monograph_presenter.title %></em> is a restricted access online resource. <%= link_to 'Go back to previous page', :back %>.</p>
</div>
<div class="row restrict-title">
  <div class="col-sm-12 col-center-block">
    <!-- TODO: this free intro is hardcoded and bad -->
    <%= restricted_message(@monograph_presenter.subdomain)&.html_safe %>
  </div>
  <div class="row">
    <div class="col-sm-4">
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">Sign in to read</h3>
        </div>
        <div class="panel-body">
          <% if current_user %>
            <p>Not you? <%= current_user.email %></p>
            <p>If you have purchased individual access you may try logging in again.</p>
            <p class="text-center">
              <form action="<%= main_app.destroy_user_session_path %>">
                <button type="submit" class="btn btn-default">Sign Out</button>
              </form>
            </p>
            <p>Or speak with an customer service representative.</p>
          <% else %>
            <p>If you have purchased individual access log in.</p>
            <p class="text-center">
              <form action="<%= main_app.new_user_session_path %>">
                <button type="submit" class="btn btn-default">Sign In</button>
              </form>
            </p>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-sm-4">
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">Read from your institution</h3>
        </div>
        <div class="panel-body">
          <% if current_institutions? %>
            <p>Not your institution?</p>
            <ul>
              <% current_institutions.each do |institution| %>
                <li><%= institution.name %></li>
              <% end %>
            </ul>
          <% end %>
          <p>You may attempt to login at the appropriate institution.</p>
          <p class="text-center">
            <%= form_tag(epub_shibboleth_path(@presenter.id), method: :post) do %>
              <select id="institution_id" name="institution_id">
                <% @institutions.each do |institution| %>
                  <% if institution.shibboleth? %>
                    <option value=<%= institution.id %>><%= institution.name %></option>
                  <% end %>
                <% end %>
              </select>
              <button type="submit">Login</button>
            <% end %>
          </p>
          <p>For other institutions.<p>
          <ul>
            <% @institutions.each do |institution| %>
              <% unless institution.shibboleth? %>
                <li><%= institution.name %></li>
              <% end %>
            <% end %>
          </ul>
          <p>You will need to access this resource on-campus or through your library's website.</p>
        </div>
      </div>
    </div>
    <div class="col-sm-4">
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">Purchase to read</h3>
        </div>
        <div class="panel-body">
          <p>You may purchase individual or institution access.</p>
          <ul>
            <% @products.each do |product| %>
              <li><%= link_to product.name, product.purchase, target: '_blank' %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-3"></div>
    <div class="col-sm-6">
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h3 class="panel-title">Federation</h3>
        </div>
        <div id="idpSelect" class="panel-body"></div>
        <script>
          idSelectUIParms = new IdPSelectUIParms();

          idSelectUIParms.dataSource = '/shibboleth/discofeed';
          //idSelectUIParms.dataSource = '<%= Rails.configuration.shibboleth_service_provider_url %>/DiscoFeed';

          idSelectUIParms.defaultLogo = '<%= asset_path('fulcrum-logo.png') %>';
          idSelectUIParms.defaultLogoWidth = 8;
          idSelectUIParms.defaultLogoHeight = 16;

          //idSelectUIParms.defaultReturn = '<%= ds_shibboleth_url %>?target=<%= epub_shibboleth_path(@presenter.id) %>';
          idSelectUIParms.defaultReturn = '<%= Rails.configuration.shibboleth_service_provider_url %>?target=<%= epub_shibboleth_path(@presenter.id) %>';

          idSelectUIParms.helpURL = '<%= help_shibboleth_url %>';

          //idSelectUIParms.myEntityID = 'https://shibboleth.umich.edu/idp/shibboleth';
          idSelectUIParms.myEntityID = 'https://shib-idp-test.www.umich.edu/idp/shibboleth';

          //idSelectUIParms.preferredIdP = ['https://shibboleth.umich.edu/idp/shibboleth'];
          idSelectUIParms.preferredIdP = ['https://shib-idp-test.www.umich.edu/idp/shibboleth'];

          idSelectUIParms.testGUI = true;
          (new IdPSelectUI()).draw(idSelectUIParms);
        </script>
      </div>
    </div>
    <div class="col-sm-3"></div>
  </div>
</div>
