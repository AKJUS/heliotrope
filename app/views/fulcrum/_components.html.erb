<%
  components = Component.filter(identifier_like: params[:identifier_like], name_like: params[:name_like], noid_like: params[:noid_like]).order(identifier: :asc).page(params[:page])
  size = 12
%>
<h1>Components</h1>
<form name="filter" method="get" action="<%= fulcrum_partials_path(:components) %>">
  <table class="table table-striped" summary="Components List">
    <tr>
      <th>
        <%= link_to(new_component_path) do %>
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New
        <% end %>
      </th>
      <th><label for="identifier_like">Identifier</label></th>
      <th><label for="name_like">Name</label></th>
      <th><label for="noid_like">Noid</label></th>
      <th>Products</th>
    </tr>
    <tr>
      <td><button name="submit" type="submit" value="filter">Filter</button></td>
      <td><input type="text" name="identifier_like" value="<%= params[:identifier_like] %>" size="<%= size %>" aria-label="identifier_like"></td>
      <td><input type="text" name="name_like" value="<%= params[:name_like] %>" size="<%= size %>" aria-label="name_like"></td>
      <td><input type="text" name="noid_like" value="<%= params[:noid_like] %>" size="<%= size %>" aria-label="noid_like"></td>
      <td></td>
    </tr>
    <% components.each do |component| %>
      <tr>
        <td><%= link_to(component_path(component)) do %>
            <span class="glyphicon glyphicon-sunglasses" aria-hidden="true"></span> Show
          <% end %>
        </td>
        <td><%= component.identifier %></td>
        <td><%= component.name %></td>
        <td>
          <%
            entity = Sighrax.factory(component.noid)
            file_set_id = 0
            monograph_id = 0
            if entity.is_a?(Sighrax::Monograph)
              monograph = entity
              monograph_id = entity.noid
            else
              file_set = entity
              file_set_id = entity.noid
              monograph = entity.parent
              monograph_id = monograph.noid
            end
          %>
          <% if file_set.present? %>
            <%= link_to file_set_id, hyrax_file_set_path(file_set_id) %>
          <% elsif monograph.present? %>
            <%= link_to monograph_id, hyrax_monograph_path(monograph_id) %>
          <% else %>
            <%= component.noid %>
          <% end %>
        </td>
        <td><%= link_to component.products.count, component_products_path(component) %></td>
      </tr>
    <% end %>
  </table>
</form>
<%= paginate components %>
